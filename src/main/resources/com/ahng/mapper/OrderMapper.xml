<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ahng.mapper.OrderMapper">

	<resultMap type="com.ahng.domain.OrderVO" id="orderMap">
		<result column="order_number" property="orderNumber" />
		<result column="userid" property="userId" />
		<result column="orderer" property="orderer" />
		<result column="orderer_contact" property="ordererContact" />
		<result column="receiver" property="receiver" />
		<result column="receiver_address" property="receiverAddress" />
		<result column="order_date" property="orderDate" />
		<collection property="pdtOnOrder" resultMap="orderMapPdt">
		</collection>
	</resultMap>

	<resultMap type="com.ahng.domain.ProductVO" id="orderMapPdt">
		<result column="pno" property="pno"></result>
		<result column="amount" property="amount"></result>
	</resultMap>

	<select id="orderList" resultMap="orderMap">
		select * from pdt_order where
		userid = #{userId}
	</select>

	<select id="orderItemList"
		resultType="com.ahng.domain.ProductVO">
		select * from pdt_order where order_number =
		#{order_number}
	</select>

	<insert id="insert">
		insert into pdt_order(order_number, userid, orderer,
		orderer_contact, receiver, receiver_address)
		values(concat(DATE_FORMAT(now(), "%Y%m%d"), lpad(floor(rand()*10000),
		4, '0')), #{userId}, #{orderer}, #{ordererContact}, #{receiver},
		#{receiverAddress})
	</insert>
	<insert id="pdtInsert">
		insert into order_pdt(order_number, pno, amount)
		values(#{orderNumber}, #{pno}, #{amount})
	</insert>

	<select id="read" resultType="com.ahng.domain.OrderVO">
		select * from pdt_order where
		order_number =
		#{orderNumber}
	</select>

	<delete id="delete">
		delete from pdt_order where userid = #{userID} and
		pno =
		#{pno}
	</delete>

	<delete id="allDelete">
		delete from pdt_order where order_number =
		#{order_number}
	</delete>


</mapper>